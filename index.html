<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
<meta name="description" content="비트코인 변동성 지수 (DVOL) 대시보드 - Deribit | Herdvibe">
<title>비트코인 변동성 지수 | Herdvibe</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
<script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.4/kakao.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html{scrollbar-width:none}
html::-webkit-scrollbar{display:none}
body{background:#000;color:#e4e4e7;font-family:'Noto Sans KR',sans-serif;min-height:100vh}

.top-nav{position:sticky;top:0;z-index:100;background:rgba(0,0,0,0.85);backdrop-filter:blur(12px);border-bottom:1px solid #1a1a1a;padding:0 16px;display:grid;grid-template-columns:1fr auto 1fr;align-items:center;height:56px}
.nav-left{min-width:0}
.nav-title{font-family:'Plus Jakarta Sans',sans-serif;font-size:1.3rem;font-weight:600;color:#e4e4e7;white-space:nowrap;text-align:center}
.nav-right{display:flex;justify-content:flex-end}

.container{max-width:960px;margin:0 auto;padding:16px 12px 60px}

.summary-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;margin-bottom:16px}
.summary-card{background:#0a0a0a;border:1px solid #1a1a1a;border-radius:10px;padding:14px 16px;text-align:center}
.summary-label{font-size:11px;color:#71717a;font-weight:500;margin-bottom:4px;text-transform:uppercase;letter-spacing:0.05em}
.summary-value{font-family:'JetBrains Mono',monospace;font-size:20px;font-weight:700}
.summary-value.price{color:#e4e4e7}
.summary-value.dvol{color:#a78bfa}

/* Tabs */
.tabs-bar{display:flex;gap:4px;justify-content:center;margin-bottom:16px}
.tab{background:#111;border:1px solid #1a1a1a;border-radius:6px;padding:6px 16px;font-size:12px;color:#a1a1aa;cursor:pointer;font-family:'JetBrains Mono',monospace;font-weight:500;transition:all 0.2s}
.tab:hover{border-color:#333;color:#e4e4e7}
.tab.active{background:#a78bfa;border-color:#a78bfa;color:#000;font-weight:600}

/* Chart Cards */
.chart-card{background:#0a0a0a;border:1px solid #1a1a1a;border-radius:12px;padding:16px;margin-bottom:2px}
.chart-card.top{border-bottom-left-radius:0;border-bottom-right-radius:0}
.chart-card.bottom{border-top-left-radius:0;border-top-right-radius:0;margin-bottom:16px}
.chart-label{font-size:11px;color:#71717a;font-weight:500;margin-bottom:12px;text-transform:uppercase;letter-spacing:0.05em}
.chart-wrapper{position:relative;height:350px}
.chart-wrapper.indicator{height:175px}

/* Share */
.share-bar{display:flex;gap:6px;justify-content:center;margin:12px 0 4px;flex-wrap:wrap}
.share-btn{display:flex;align-items:center;gap:5px;padding:6px 12px;border-radius:6px;border:1px solid #222;background:#0a0a0a;color:#a1a1aa;font-size:11px;cursor:pointer;font-family:'Noto Sans KR',sans-serif;transition:all 0.2s}
.share-btn:hover{border-color:#444;color:#e4e4e7}
.share-btn svg{width:14px;height:14px;flex-shrink:0}
.share-btn.twitter:hover{border-color:#1d9bf0;color:#1d9bf0}
.share-btn.kakao:hover{border-color:#fee500;color:#fee500}
.share-btn.telegram:hover{border-color:#26a5e4;color:#26a5e4}
.share-btn.copy:hover{border-color:#22c55e;color:#22c55e}
.share-btn.copied{border-color:#22c55e;color:#22c55e}
.share-btn.instagram:hover{border-color:#e1306c;color:#e1306c}
.share-btn.instagram.copied{border-color:#e1306c;color:#e1306c}

.toast{position:fixed;bottom:20px;right:20px;background:#22c55e;color:#000;padding:10px 16px;border-radius:8px;font-size:13px;font-weight:600;z-index:9999;opacity:0;transform:translateY(10px);transition:all 0.3s ease;pointer-events:none}
.toast.show{opacity:1;transform:translateY(0)}

.last-updated{text-align:center;font-size:11px;color:#52525b;margin-top:8px}

.loading{display:flex;align-items:center;justify-content:center;height:350px;color:#71717a;font-size:13px}
.error{text-align:center;padding:60px 20px;color:#ef4444;font-size:13px}

@media(max-width:768px){
  .top-nav{padding:0 10px;height:52px}
  .nav-title{font-size:1.1rem}
  .summary-value{font-size:16px}
  .chart-wrapper{height:280px}
  .chart-wrapper.indicator{height:140px}
}
@media(max-width:380px){.nav-title{font-size:1rem}}
</style>
</head>
<body>

<nav class="top-nav">
    <div class="nav-left"></div>
    <div class="nav-title">비트코인 변동성 지수</div>
    <div class="nav-right"></div>
</nav>

<div class="container">
    <div class="summary-grid">
        <div class="summary-card"><div class="summary-label">Bitcoin Price</div><div class="summary-value price" id="btc-price">--</div></div>
        <div class="summary-card"><div class="summary-label">Volatility (30D)</div><div class="summary-value dvol" id="dvol-value">--</div></div>
    </div>

    <div class="tabs-bar" id="period-tabs">
        <button class="tab" data-period="6m">6M</button>
        <button class="tab active" data-period="1y">1Y</button>
        <button class="tab" data-period="3y">3Y</button>
    </div>

    <div class="chart-card top">
        <div class="chart-label">Bitcoin Price (USD)</div>
        <div class="chart-wrapper" id="price-wrapper">
            <div class="loading">Loading data...</div>
        </div>
    </div>

    <div class="chart-card bottom">
        <div class="chart-label">Volatility Index</div>
        <div class="chart-wrapper indicator" id="dvol-wrapper">
            <div class="loading">Loading data...</div>
        </div>
    </div>

    <div class="share-bar">
        <button class="share-btn twitter" onclick="shareTwitter()"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>트위터</button>
        <button class="share-btn kakao" onclick="shareKakao()"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3c-5.52 0-10 3.36-10 7.5 0 2.66 1.74 5 4.36 6.33-.14.53-.9 3.4-.93 3.61 0 0-.02.17.09.23.11.07.24.03.24.03.32-.04 3.7-2.42 4.28-2.83.62.09 1.27.13 1.96.13 5.52 0 10-3.36 10-7.5S17.52 3 12 3z"/></svg>카카오톡</button>
        <button class="share-btn telegram" onclick="shareTelegram()"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.479.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>텔레그램</button>
        <button class="share-btn instagram" onclick="shareInstagram(this)"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg>인스타그램</button>
        <button class="share-btn copy" onclick="copyLink()" id="copyLinkBtn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>링크복사</button>
    </div>
    <div class="last-updated" id="last-updated">Bitcoin Volatility Index · 30-Day Rolling</div>
</div>

<div class="toast" id="toast"></div>

<script>
/* ===== Share Functions ===== */
var SHARE_URL='https://herdvibe.com/27';
var SHARE_TITLE='비트코인 변동성 지수 대시보드';
var SHARE_DESC='비트코인 변동성 실시간 차트 | Herdvibe';
function showToast(m){var t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(function(){t.classList.remove('show')},3000)}
function shareTwitter(){window.open('https://twitter.com/intent/tweet?text='+encodeURIComponent(SHARE_TITLE)+'&url='+encodeURIComponent(SHARE_URL),'_blank')}
function shareKakao(){if(window.Kakao&&!Kakao.isInitialized())Kakao.init('a43ed7b39fac35458f4f9df925a279b5');if(window.Kakao){Kakao.Share.sendDefault({objectType:'feed',content:{title:SHARE_TITLE,description:SHARE_DESC,imageUrl:'https://herdvibe.com/og-dvol.png',link:{mobileWebUrl:SHARE_URL,webUrl:SHARE_URL}}})}}
function shareTelegram(){window.open('https://t.me/share/url?url='+encodeURIComponent(SHARE_URL)+'&text='+encodeURIComponent(SHARE_TITLE),'_blank')}
function _clipCopy(t){if(window.parent!==window){window.parent.postMessage({type:'copy',text:t},'*')}if(navigator.clipboard&&navigator.clipboard.writeText&&window.isSecureContext){navigator.clipboard.writeText(t).catch(function(){_fbCopy(t)})}else{_fbCopy(t)}}function _fbCopy(t){var a=document.createElement('textarea');a.value=t;a.style.cssText='position:fixed;left:-9999px;top:-9999px;opacity:0';document.body.appendChild(a);a.focus();a.select();try{document.execCommand('copy')}catch(e){}document.body.removeChild(a)}
function copyLink(){var b=document.getElementById('copyLinkBtn');_clipCopy(SHARE_URL);b.classList.add('copied');b.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>복사됨!';showToast('링크가 복사되었습니다');setTimeout(function(){b.classList.remove('copied');b.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>링크복사'},2000)}
function shareInstagram(b){_clipCopy(SHARE_URL);var o=b.innerHTML;b.classList.add('copied');b.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>복사됨!';showToast('링크가 복사되었습니다 - 인스타그램에 붙여넣기 하세요');setTimeout(function(){b.classList.remove('copied');b.innerHTML=o},2000)}

/* ===== Watermark Plugin ===== */
var watermarkPlugin = {
    id: 'watermark',
    afterDraw: function(chart) {
        var ctx = chart.ctx;
        var area = chart.chartArea;
        if (!area) return;
        var h = area.bottom - area.top;
        var sz = h > 200 ? 28 : 16;
        ctx.save();
        ctx.font = "700 " + sz + "px 'Plus Jakarta Sans', sans-serif";
        ctx.fillStyle = 'rgba(255, 255, 255, 0.04)';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        var cx = (area.left + area.right) / 2;
        var cy = (area.top + area.bottom) / 2;
        ctx.fillText('Herdvibe.com', cx, cy);
        ctx.restore();
    }
};
Chart.register(watermarkPlugin);

/* Zone Badge Plugin - draws corner badges on DVOL chart */
var zoneBadgePlugin = {
    id: 'zoneBadge',
    afterDraw: function(chart) {
        if (!chart.config.options.plugins.zoneBadge) return;
        var ctx = chart.ctx;
        var area = chart.chartArea;
        if (!area) return;
        var badges = [
            { text: '과변동성  >60%', color: '#ef4444', bg: 'rgba(239,68,68,0.12)', y: area.top },
            { text: '저변동성  <40%', color: '#22c55e', bg: 'rgba(34,197,94,0.12)', y: area.bottom }
        ];
        ctx.save();
        ctx.font = "500 10px 'Noto Sans KR', sans-serif";
        badges.forEach(function(b) {
            var tw = ctx.measureText(b.text).width;
            var px = 6, py = 3, r = 4;
            var bw = tw + px * 2;
            var bh = 18;
            var bx = area.left + 8;
            var by = b.y === area.top ? area.top + 8 : area.bottom - 8 - bh;
            /* rounded rect */
            ctx.beginPath();
            ctx.moveTo(bx + r, by);
            ctx.lineTo(bx + bw - r, by);
            ctx.quadraticCurveTo(bx + bw, by, bx + bw, by + r);
            ctx.lineTo(bx + bw, by + bh - r);
            ctx.quadraticCurveTo(bx + bw, by + bh, bx + bw - r, by + bh);
            ctx.lineTo(bx + r, by + bh);
            ctx.quadraticCurveTo(bx, by + bh, bx, by + bh - r);
            ctx.lineTo(bx, by + r);
            ctx.quadraticCurveTo(bx, by, bx + r, by);
            ctx.closePath();
            ctx.fillStyle = b.bg;
            ctx.fill();
            /* text */
            ctx.fillStyle = b.color;
            ctx.textBaseline = 'middle';
            ctx.fillText(b.text, bx + px, by + bh / 2);
        });
        ctx.restore();
    }
};
Chart.register(zoneBadgePlugin);

/* ===== Chart Logic ===== */
var btcChart = null;
var dvolChart = null;
var fullData = null;
var currentPeriod = '1y';

function formatCurrency(value) {
    return new Intl.NumberFormat('en-US', {
        style: 'currency', currency: 'USD',
        minimumFractionDigits: 0, maximumFractionDigits: 0
    }).format(value);
}

function getPeriodDays(period) {
    if (period === '6m') return 182;
    if (period === '1y') return 365;
    if (period === '3y') return 1095;
    return 365;
}

function filterData(data, period) {
    var days = getPeriodDays(period);
    var totalLen = data.dates.length;
    var startIdx = Math.max(0, totalLen - days);
    return {
        dates: data.dates.slice(startIdx),
        btc_prices: data.btc_prices.slice(startIdx),
        dvol: data.dvol.slice(startIdx),
        current_price: data.current_price,
        current_dvol: data.current_dvol,
        last_updated: data.last_updated
    };
}

async function loadData() {
    try {
        var response = await fetch('data.json');
        if (!response.ok) throw new Error('Data not found');
        return await response.json();
    } catch (error) {
        console.error('Error loading data:', error);
        return null;
    }
}

function updateStats(data) {
    document.getElementById('btc-price').textContent = formatCurrency(data.current_price);
    document.getElementById('dvol-value').textContent = data.current_dvol.toFixed(1) + '%';
}

function createBtcChart(data) {
    var wrapper = document.getElementById('price-wrapper');
    wrapper.innerHTML = '<canvas id="btcChart"></canvas>';
    var ctx = document.getElementById('btcChart').getContext('2d');
    var dates = data.dates.map(function(d){ return new Date(d); });

    var gradient = ctx.createLinearGradient(0, 0, 0, 350);
    gradient.addColorStop(0, 'rgba(113, 113, 122, 0.12)');
    gradient.addColorStop(1, 'rgba(113, 113, 122, 0)');

    btcChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: dates,
            datasets: [{
                label: 'BTC Price',
                data: data.btc_prices,
                borderColor: '#71717a',
                backgroundColor: gradient,
                borderWidth: 1.5,
                fill: true,
                tension: 0.3,
                pointRadius: 0,
                pointHoverRadius: 4,
                pointHoverBackgroundColor: '#e4e4e7',
                pointHoverBorderColor: '#e4e4e7'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: { duration: 400, easing: 'easeOutQuart' },
            interaction: { mode: 'index', intersect: false },
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: '#0a0a0a',
                    borderColor: '#1a1a1a',
                    borderWidth: 1,
                    titleColor: '#e4e4e7',
                    bodyColor: '#a1a1aa',
                    titleFont: { family: "'Noto Sans KR', sans-serif", size: 12 },
                    bodyFont: { family: "'JetBrains Mono', monospace", size: 12 },
                    padding: 12,
                    cornerRadius: 8,
                    displayColors: false,
                    callbacks: {
                        title: function(context) {
                            var date = new Date(context[0].parsed.x);
                            return date.toLocaleDateString('ko-KR', { year: 'numeric', month: 'short', day: 'numeric' });
                        },
                        label: function(context) {
                            return 'BTC  ' + formatCurrency(context.raw);
                        }
                    }
                }
            },
            scales: {
                x: {
                    type: 'time',
                    time: { unit: 'month', displayFormats: { month: 'MMM yy' } },
                    grid: { color: '#1a1a1a', drawBorder: false },
                    ticks: { display: false }
                },
                y: {
                    type: 'linear',
                    position: 'right',
                    afterFit: function(axis) { axis.width = 65; },
                    grid: { color: '#1a1a1a', drawBorder: false },
                    ticks: {
                        color: '#52525b',
                        font: { family: "'JetBrains Mono', monospace", size: 10 },
                        callback: function(v) {
                            if (v >= 1000) return '$' + (v/1000).toFixed(0) + 'k';
                            return '$' + v;
                        }
                    }
                }
            }
        }
    });
}

function createDvolChart(data) {
    var wrapper = document.getElementById('dvol-wrapper');
    wrapper.innerHTML = '<canvas id="dvolChart"></canvas>';
    var ctx = document.getElementById('dvolChart').getContext('2d');
    var dates = data.dates.map(function(d){ return new Date(d); });

    var gradient = ctx.createLinearGradient(0, 0, 0, 175);
    gradient.addColorStop(0, 'rgba(167, 139, 250, 0.15)');
    gradient.addColorStop(1, 'rgba(167, 139, 250, 0)');

    dvolChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: dates,
            datasets: [{
                label: 'Volatility',
                data: data.dvol,
                borderColor: '#a78bfa',
                backgroundColor: gradient,
                borderWidth: 1.5,
                fill: true,
                tension: 0.3,
                pointRadius: 0,
                pointHoverRadius: 4,
                pointHoverBackgroundColor: '#a78bfa',
                pointHoverBorderColor: '#a78bfa'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: { duration: 400, easing: 'easeOutQuart' },
            interaction: { mode: 'index', intersect: false },
            plugins: {
                legend: { display: false },
                zoneBadge: true,
                tooltip: {
                    backgroundColor: '#0a0a0a',
                    borderColor: '#1a1a1a',
                    borderWidth: 1,
                    titleColor: '#e4e4e7',
                    bodyColor: '#a1a1aa',
                    titleFont: { family: "'Noto Sans KR', sans-serif", size: 12 },
                    bodyFont: { family: "'JetBrains Mono', monospace", size: 12 },
                    padding: 12,
                    cornerRadius: 8,
                    displayColors: false,
                    callbacks: {
                        title: function(context) {
                            var date = new Date(context[0].parsed.x);
                            return date.toLocaleDateString('ko-KR', { year: 'numeric', month: 'short', day: 'numeric' });
                        },
                        label: function(context) {
                            return 'VOL  ' + context.raw.toFixed(1) + '%';
                        }
                    }
                },
                annotation: {
                    annotations: {
                        redZone: {
                            type: 'box', yMin: 60, yMax: 120,
                            backgroundColor: 'rgba(239, 68, 68, 0.06)',
                            borderWidth: 0
                        },
                        greenZone: {
                            type: 'box', yMin: 0, yMax: 40,
                            backgroundColor: 'rgba(34, 197, 94, 0.06)',
                            borderWidth: 0
                        },
                        redLine: {
                            type: 'line', yMin: 60, yMax: 60,
                            borderColor: 'rgba(239, 68, 68, 0.35)',
                            borderWidth: 1, borderDash: [4, 4]
                        },
                        greenLine: {
                            type: 'line', yMin: 40, yMax: 40,
                            borderColor: 'rgba(34, 197, 94, 0.35)',
                            borderWidth: 1, borderDash: [4, 4]
                        }
                    }
                }
            },
            scales: {
                x: {
                    type: 'time',
                    time: { unit: 'month', displayFormats: { month: 'MMM yy' } },
                    grid: { color: '#1a1a1a', drawBorder: false },
                    ticks: {
                        color: '#52525b',
                        font: { family: "'JetBrains Mono', monospace", size: 10 },
                        maxTicksLimit: 8, autoSkip: true
                    }
                },
                y: {
                    type: 'linear',
                    position: 'right',
                    min: 0,
                    afterFit: function(axis) { axis.width = 65; },
                    grid: { color: '#1a1a1a', drawBorder: false },
                    ticks: {
                        color: '#52525b',
                        font: { family: "'JetBrains Mono', monospace", size: 10 },
                        stepSize: 20,
                        callback: function(v) { return v + '%'; }
                    }
                }
            }
        }
    });
}

function updateCharts(period) {
    if (!fullData) return;
    currentPeriod = period;
    var filtered = filterData(fullData, period);

    if (btcChart) btcChart.destroy();
    if (dvolChart) dvolChart.destroy();

    createBtcChart(filtered);
    createDvolChart(filtered);

    // Update tab styles
    document.querySelectorAll('#period-tabs .tab').forEach(function(btn) {
        btn.classList.remove('active');
        if (btn.dataset.period === period) btn.classList.add('active');
    });
}

function initTabs() {
    document.querySelectorAll('#period-tabs .tab').forEach(function(btn) {
        btn.addEventListener('click', function() {
            updateCharts(btn.dataset.period);
        });
    });
}

async function init() {
    var data = await loadData();
    if (!data || !data.dates || data.dates.length === 0) {
        document.getElementById('price-wrapper').innerHTML = '<div class="error">데이터를 불러올 수 없습니다.<br><span style="color:#52525b;font-size:11px">data.json 파일이 같은 디렉토리에 있는지 확인하세요.</span></div>';
        document.getElementById('dvol-wrapper').innerHTML = '<div class="error"></div>';
        return;
    }

    fullData = data;
    updateStats(data);
    initTabs();
    updateCharts(currentPeriod);

    if (data.last_updated) {
        document.getElementById('last-updated').textContent =
            'Last updated: ' + new Date(data.last_updated).toLocaleDateString('en-US', {
                year: 'numeric', month: 'short', day: 'numeric'
            }) + ' · 30-Day Rolling Volatility';
    }
}

init();
</script>
<script>
function sendHeight(){var h=document.documentElement.scrollHeight;window.parent.postMessage({id:'hvBtcDvol',height:h},'*')}
window.addEventListener('load',function(){sendHeight();setTimeout(sendHeight,500);setTimeout(sendHeight,1500)});
window.addEventListener('resize',sendHeight);
new MutationObserver(sendHeight).observe(document.body,{childList:true,subtree:true,attributes:true});
</script>
</body>
</html>
